<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-5Y3RVQ83FV"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-5Y3RVQ83FV');
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="台灣股票利潤計算機，支援即時台股價格查詢與券商手續費計算，快速計算您的股票交易利潤。">
    <meta name="keywords" content="股票利潤計算機, 台股計算, 即時股票價格, 券商手續費, 台灣股市, 吉米理財學堂">
    <meta name="author" content="吉米理財學堂">
    <meta name="robots" content="index, follow">
    <title>台灣股票利潤計算機 - <a href="https://www.youtube.com/@吉米理財學堂" target="_blank">吉米理財學堂</a></title>
    <!-- Open Graph Meta Tags for Social Media -->
    <meta property="og:title" content="台灣股票利潤計算機 - 吉米理財學堂">
    <meta property="og:description" content="快速計算台股交易利潤，支援即時價格查詢與手續費折扣計算。">
    <meta property="og:url" content="https://xbon520.github.io/">
    <meta property="og:type" content="website">
    <!-- Structured Data (JSON-LD) for SEO -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "台灣股票利潤計算機",
        "url": "https://xbon520.github.io/",
        "description": "一款免費的台灣股票利潤計算工具，支援即時台股價格查詢與券商手續費折扣計算。",
        "publisher": {
            "@type": "Organization",
            "name": "吉米理財學堂",
            "url": "https://www.youtube.com/@吉米理財學堂",
            "email": "xbon510@gmail.com"
        },
        "applicationCategory": "Finance"
    }
    </script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f4f4f4;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .header {
            text-align: center;
            padding: 20px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .form-section {
            background-color: #fff;
            padding: 20px;
            margin-top: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .result-section {
            margin-top: 20px;
            padding: 20px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .ad-space {
            margin: 20px 0;
            text-align: center;
        }
        .guide-section {
            margin-top: 20px;
            padding: 20px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            text-align: left;
        }
        .guide-section h1 {
            font-size: 24px;
            margin-bottom: 10px;
        }
        .guide-section h2 {
            font-size: 18px;
            margin-top: 20px;
            margin-bottom: 10px;
        }
        .guide-section p {
            line-height: 1.6;
        }
        .guide-section ul {
            margin-left: 20px;
            line-height: 1.6;
        }
        .privacy-section {
            margin-top: 20px;
            padding: 20px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            text-align: left;
        }
        input, select, button {
            padding: 10px;
            margin: 5px 0;
            width: 100%;
            box-sizing: border-box;
        }
        button {
            background-color: #1E90FF;
            color: #FFFFFF;
            border: none;
            cursor: pointer;
            font-weight: bold;
        }
        button:hover {
            background-color: #0066CC;
        }
        footer {
            text-align: center;
            margin-top: 20px;
            font-size: 14px;
            color: #666;
        }
        .row {
            display: flex;
            justify-content: space-between;
            gap: 20px;
        }
        .row > div {
            flex: 1;
        }
        .swap-button-container {
            display: flex;
            justify-content: center;
            margin: 10px 0;
        }
        .swap-button-container button {
            width: 100px;
        }
        .profit-positive {
            background-color: #FF0000;
            color: #FFFFFF;
            padding: 2px 8px;
            border-radius: 4px;
        }
        .profit-negative {
            background-color: #008000;
            color: #FFFFFF;
            padding: 2px 8px;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>台灣股票利潤計算機</h1>
            <p>輸入資料以計算您的股票交易利潤</p>
        </div>

        <div class="ad-space" id="banner-ad">
            <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3440199491716602"
                    crossorigin="anonymous"></script>
            <ins class="adsbygoogle"
                 style="display:block"
                 data-ad-client="ca-pub-3440199491716602"
                 data-ad-slot="1234567890"
                 data-ad-format="auto"
                 data-full-width-responsive="true"></ins>
            <script>
                (adsbygoogle = window.adsbygoogle || []).push({});
            </script>
        </div>

        <div class="form-section">
            <div class="swap-button-container">
                <button onclick="swapPrices()">價格互換</button>
            </div>
            
            <label for="buy-price">買入價格:</label>
            <input type="number" id="buy-price" step="0.01" placeholder="輸入買入價格">

            <label for="sell-price">賣出價格:</label>
            <input type="number" id="sell-price" step="0.01" placeholder="輸入賣出價格">

            <label for="shares">股票張數 (零股用小數，如 0.1 = 100股):</label>
            <input type="number" id="shares" step="0.001" placeholder="輸入張數">

            <div class="row">
                <div>
                    <label for="fee-discount">券商手續費折扣:</label>
                    <select id="fee-discount">
                        <!-- 選項保持不變，略過重複列出 -->
                        <option value="0.65" selected>6.5 折 (預設)</option>
                        <!-- 其他選項省略 -->
                    </select>
                </div>
                <div>
                    <label for="trade-mode">交易模式:</label>
                    <select id="trade-mode">
                        <option value="台股">台股</option>
                        <option value="ETF">ETF</option>
                        <option value="現股當沖">現股當沖</option>
                    </select>
                </div>
            </div>

            <button onclick="calculateProfit()">計算利潤</button>

            <label for="stock-code">股票代號 (如 2330):</label>
            <input type="text" id="stock-code" placeholder="輸入股票代號以抓取即時價格">
            <button onclick="fetchStockPrice()">抓取即時價格</button>
        </div>

        <div class="result-section" id="result">
            <h2>分析報告</h2>
            <p>利潤: <span id="profit">0</span></p>
            <p>買入總額: <span id="buy-total">0</span></p>
            <p>賣出總額: <span id="sell-total">0</span></p>
            <p>買入手續費: <span id="buy-fee">0</span></p>
            <p>賣出手續費: <span id="sell-fee">0</span></p>
            <p>證券交易稅: <span id="tax">0</span></p>
        </div>

        <div class="ad-space" id="responsive-ad">
            <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3440199491716602"
                    crossorigin="anonymous"></script>
            <ins class="adsbygoogle"
                 style="display:block"
                 data-ad-client="ca-pub-3440199491716602"
                 data-ad-slot="0987654321"
                 data-ad-format="auto"
                 data-full-width-responsive="true"></ins>
            <script>
                (adsbygoogle = window.adsbygoogle || []).push({});
            </script>
        </div>
        
        <div class="guide-section">
            <!-- 使用說明保持不變，略過重複列出 -->
        </div>
        
        <div class="privacy-section">
            <h1>隱私權政策</h1>
            <p>我們的應用程式不會收集個人資訊。</p>
            <p>理財工具系列作品由 <a href="https://www.youtube.com/@吉米理財學堂" target="_blank">吉米理財學堂</a> 授權開發</p>
            <p>如有任何問題，請聯絡我們：<a href="mailto:xbon510@gmail.com">xbon510@gmail.com</a></p>
        </div>

        <footer>
            <p>© 2025 <a href="https://www.youtube.com/@吉米理財學堂" target="_blank">吉米理財學堂</a>。保留所有權利。</p>
        </footer>
    </div>

    <script>
        // 格式化數字為千位分隔符
        function formatNumber(num) {
            return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }

        // 抓取股票價格並更新 Google Sheets
        function fetchStockPrice() {
            const stockCode = document.getElementById("stock-code").value;
            if (!stockCode) {
                alert("請輸入股票代號！");
                return;
            }

            const scriptUrl = "https://script.google.com/macros/s/AKfycbwHiVx4lESoOhJIOzjcbda_1jD25FhV5lATc3MCebtXdDYf0q2tvCXUy4ajCzZ9YTWepA/exec"; // 替換為你的 Apps Script 網址
            const data = { stockCode: stockCode };

            fetch(scriptUrl, {
                method: "POST",
                body: JSON.stringify(data),
                headers: {
                    "Content-Type": "application/json"
                }
            })
            .then(response => response.json())
            .then(data => {
                console.log("Google Sheets 回傳:", data);
                if (data.price && data.price !== "無數據") {
                    document.getElementById("buy-price").value = data.price;
                    alert(`已抓取 ${stockCode} 的即時價格：${data.price}`);
                } else {
                    alert("無法抓取價格，可能是股票代號錯誤或無即時數據！");
                }
            })
            .catch(error => {
                console.error("抓取價格失敗:", error);
                alert("抓取價格失敗，請檢查網路或聯繫管理員！");
            });
        }

        // 互換買入價格與賣出價格
        function swapPrices() {
            const buyPrice = document.getElementById("buy-price").value;
            const sellPrice = document.getElementById("sell-price").value;
            document.getElementById("buy-price").value = sellPrice;
            document.getElementById("sell-price").value = buyPrice;
        }

        // 計算利潤
        function calculateProfit() {
            const buyPrice = parseFloat(document.getElementById("buy-price").value) || 0;
            const sellPrice = parseFloat(document.getElementById("sell-price").value) || 0;
            const shares = parseFloat(document.getElementById("shares").value) || 0;
            const discount = parseFloat(document.getElementById("fee-discount").value);
            const mode = document.getElementById("trade-mode").value;
            const volume = shares * 1000;

            let buyFeeRate, sellFeeRate, taxRate;
            switch (mode) {
                case "台股":
                    buyFeeRate = 0.001425;
                    sellFeeRate = 0.001425;
                    taxRate = 0.003;
                    break;
                case "ETF":
                    buyFeeRate = 0.001;
                    sellFeeRate = 0.001;
                    taxRate = 0.001;
                    break;
                case "現股當沖":
                    buyFeeRate = 0.0015;
                    sellFeeRate = 0.0015;
                    taxRate = 0.0015;
                    break;
                default:
                    buyFeeRate = 0.001425;
                    sellFeeRate = 0.001425;
                    taxRate = 0.003;
            }

            let buyFee = Math.max(buyPrice * volume * buyFeeRate * discount, 20);
            let sellFee = Math.max(sellPrice * volume * sellFeeRate * discount, 20);
            if (buyPrice === 0 || shares === 0) buyFee = 0;
            if (sellPrice === 0 || shares === 0) sellFee = 0;

            const tax = sellPrice * volume * taxRate;

            const buyTotal = buyPrice * volume + buyFee;
            const sellTotal = sellPrice * volume - sellFee - tax;
            const profit = sellTotal - buyTotal;

            const profitElement = document.getElementById("profit");
            const buyTotalElement = document.getElementById("buy-total");
            const sellTotalElement = document.getElementById("sell-total");

            const formattedProfit = formatNumber(profit.toFixed(0));
            const formattedBuyTotal = formatNumber(buyTotal.toFixed(0));
            const formattedSellTotal = formatNumber(sellTotal.toFixed(0));

            const className = profit >= 0 ? "profit-positive" : "profit-negative";
            profitElement.innerText = formattedProfit;
            profitElement.className = className;
            buyTotalElement.innerText = formattedBuyTotal;
            buyTotalElement.className = className;
            sellTotalElement.innerText = formattedSellTotal;
            sellTotalElement.className = className;

            document.getElementById("buy-fee").innerText = formatNumber(buyFee.toFixed(0));
            document.getElementById("sell-fee").innerText = formatNumber(sellFee.toFixed(0));
            document.getElementById("tax").innerText = formatNumber(tax.toFixed(0));
        }
    </script>
</body>
</html>
