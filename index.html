<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-Q32FFR42XT"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-Q32FFR42XT');
    </script>
    
    <!-- Google adsense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3440199491716602"
     crossorigin="anonymous"></script>
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="台灣股票利潤計算機，支援券商手續費計算，快速計算您的股票交易利潤。">
    <meta name="image" content="https://www.stockcorp.tw/img/small.jpg">
    <meta name="keywords" content="股票利潤計算機, 台股計算, 券商手續費, 台灣股市, 吉米理財學堂">
    <meta name="author" content="吉米理財學堂">
    <meta name="robots" content="index, follow">
    <title>股市企業研究院 - 台灣股票利潤計算機 - 吉米理財學堂</title>
    <!-- Open Graph Meta Tags for Social Media -->
    <meta property="og:title" content="股市企業研究院 - 台灣股票利潤計算機 - 吉米理財學堂">
    <meta property="og:description" content="快速計算台股交易利潤，支援手續費折扣計算。">
    <meta property="og:url" content="https://xbon520.github.io/">
    <meta property="og:type" content="website">
    <!-- Structured Data (JSON-LD) for SEO -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "台灣股票利潤計算機",
        "url": "https://xbon520.github.io/",
        "description": "一款免費的台灣股票利潤計算工具，支援券商手續費折扣計算。",
        "publisher": {
            "@type": "Organization",
            "name": "吉米理財學堂",
            "url": "https://www.youtube.com/@吉米理財學堂",
            "email": "xbon510@gmail.com"
        },
        "applicationCategory": "Finance"
    }
    </script>
    <!-- html2canvas 庫用於將分析報告轉為圖片 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #1a1a1a; /* 黑色背景 */
            color: #ffffff; /* 白色文字 */
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }
        .left-column {
            flex: 1;
            min-width: 300px;
        }
        .right-column {
            flex: 2;
            min-width: 300px;
        }
        /* 標題與下拉選單容器 */
        .header-section {
            margin-bottom: 20px;
        }
        /* 下拉選單樣式 */
        .nav-dropdown {
            background-color: #2d2d2d; /* 與標題框一致 */
            padding: 8px 12px;
            font-size: 14px;
            color: #ffffff;
            border: 1px solid #666;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s ease, border-color 0.3s ease;
            width: 150px; /* 固定寬度，優雅且不過分佔空間 */
            margin-bottom: 10px; /* 與標題框間距 */
        }
        .nav-dropdown:hover {
            background-color: #3a3a3a; /* 懸停時略亮 */
            border-color: #888;
        }
        .nav-dropdown:focus {
            outline: none;
            border-color: #00ccff; /* 聚焦時亮藍邊框 */
            box-shadow: 0 0 5px rgba(0, 204, 255, 0.5); /* 微光效果 */
        }
        /* 標題框 */
        .site-title {
            background-color: #2d2d2d;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(255,255,255,0.1);
            width: fit-content;
            display: flex;
            align-items: center;
        }
        .site-title h1 {
            font-size: 28px;
            margin: 0;
            color: #ffffff;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
            display: inline;
        }
        .header {
            text-align: center;
            padding: 40px 20px;
            background-image: url('https://www.stockcorp.tw/img/channels4_banner.jpg');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(255,255,255,0.1);
            position: relative;
            width: 100%;
            height: 60px;
        }
        .form-section {
            background-color: #2d2d2d;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(255,255,255,0.1);
        }
        .result-section {
            margin-top: 20px;
            padding: 20px;
            background-color: #2d2d2d;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(255,255,255,0.1);
            position: relative;
        }
        .button-container {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 10px;
            align-items: center;
        }
        .links-section {
            margin-top: 20px;
            padding: 20px;
            background-color: #2d2d2d;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(255,255,255,0.1);
        }
        .ad-space {
            margin: 20px 0;
            text-align: center;
        }
        .guide-section {
            margin-top: 20px;
            padding: 20px;
            background-color: #2d2d2d;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(255,255,255,0.1);
            text-align: left;
        }
        .guide-section h1, .privacy-section h1, .links-section h1 {
            font-size: 24px;
            margin-bottom: 10px;
            color: #00ccff;
        }
        .guide-section h2 {
            font-size: 18px;
            margin-top: 20px;
            margin-bottom: 10px;
            color: #00ccff;
        }
        .result-section h2 {
            font-size: 24px;
            margin-bottom: 10px;
            color: #ffffff;
        }
        .links-section h1 {
            font-size: 24px;
            margin-bottom: 10px;
            color: #ffffff;
        }
        .section-title {
            font-size: 24px;
            color: #ffffff;
            margin-bottom: 10px;
        }
        .guide-section p, .privacy-section p, .links-section p {
            line-height: 1.6;
            color: #e0e0e0;
        }
        .guide-section ul, .links-section ul {
            margin-left: 20px;
            line-height: 1.6;
            color: #e0e0e0;
        }
        .privacy-section {
            margin-top: 20px;
            padding: 20px;
            background-color: #2d2d2d;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(255,255,255,0.1);
            text-align: left;
        }
        input, select {
            padding: 10px;
            margin: 5px 0;
            width: 100%;
            box-sizing: border-box;
            background-color: #404040;
            color: #ffffff;
            border: 1px solid #666;
            border-radius: 4px;
        }
        button {
            padding: 10px;
            margin: 5px 0;
            width: 100%;
            background-color: #00ccff;
            color: #000000;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }
        button:hover {
            background-color: #0099cc;
        }
        .download-button {
            padding: 0;
            width: 32px;
            height: 32px;
            background-image: url('img/download.jpg');
            background-size: cover;
            background-color: transparent;
            border-radius: 4px;
            font-size: 14px;
        }
        .swap-button {
            padding: 0;
            width: 32px;
            height: 32px;
            background-image: url('img/price_replace.jpg');
            background-size: cover;
            background-color: transparent;
            border-radius: 4px;
        }
        .line-button, .facebook-button {
            width: 32px;
            height: 32px;
            background-size: cover;
            border: none;
            cursor: pointer;
            padding: 0;
            margin: 0;
            border-radius: 4px;
        }
        .line-button {
            background-image: url('https://upload.wikimedia.org/wikipedia/commons/4/41/LINE_logo.svg');
        }
        .facebook-button {
            background-image: url('https://upload.wikimedia.org/wikipedia/commons/5/51/Facebook_f_logo_%282019%29.svg');
        }
        footer {
            text-align: center;
            margin-top: 20px;
            font-size: 14px;
            color: #999;
        }
        .row {
            display: flex;
            justify-content: space-between;
            gap: 20px;
        }
        .row > div {
            flex: 1;
        }
        .swap-button-container {
            display: flex;
            justify-content: center;
            margin: 10px 0;
        }
        .swap-button-container button {
            width: 32px; /* 調整為圖片大小 */
            height: 32px;
        }
        .profit-positive {
            background-color: #ff4444;
            color: #ffffff;
            padding: 2px 8px;
            border-radius: 4px;
        }
        .profit-negative {
            background-color: #00cc00;
            color: #ffffff;
            padding: 2px 8px;
            border-radius: 4px;
        }
        a {
            color: #00ccff;
            text-decoration: none;
        }
        a:hover {
            text-decoration: underline;
        }
        /* 隱藏的臨時容器樣式 */
        #screenshot-container {
            position: absolute;
            top: -9999px;
            left: -9999px;
            background-color: #1a1a1a;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            width: 300px; /* 與左側欄寬度一致 */
        }

        /* 新增按鈕容器樣式 */
        .button-with-text {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            gap: 5px; /* 圖案與文字間距 */
            cursor: pointer;
        }
        .button-with-text span {
            color: #ffffff;
            font-size: 12px;
            line-height: 1;
        }
        /* 隱藏 label 給螢幕閱讀器使用 */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            border: 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- 橫幅 -->
        <div style="width: 100%;">
            <div class="header"></div>
        </div>

        <!-- 左側欄：標題與計算區域 -->
        <div class="left-column">
            <!-- 下拉選單與標題 -->
            <div class="header-section">
                <label for="nav-select" class="sr-only">選擇頁面</label>
                <select id="nav-select" class="nav-dropdown" onchange="if (this.value) window.location.href = this.value;">
                    <option value="https://xbon520.github.io/" selected>首頁</option>
                    <option value="https://xbon520.github.io/compound.html">複利計算機</option>
                    <option value="https://xbon520.github.io/about.html">關於我們</option>
                </select>
                <div class="site-title">
                    <img src="https://www.stockcorp.tw/img/icon1.jpg" alt="股市企業研究院圖標" style="vertical-align: middle; margin-right: 10px; height: 28px; width: auto;">
                    <h1>股 市 企 業 研 究 院</h1>
                </div>
            </div>

            <!-- 輸入表單 -->
            <div class="form-section">
                <h2>台灣股票利潤計算機</h2>
                <hr>
                <label for="buy-price">買入價格:</label>
                <input type="number" id="buy-price" step="0.01" placeholder="輸入買入價格" value='23'>
                <div class="swap-button-container">
                    <div class="button-with-text" onclick="swapPrices()">
                        <button class="swap-button"></button>
                        <span>價格切換</span>
                    </div>
                </div>
                <label for="sell-price">賣出價格:</label>
                <input type="number" id="sell-price" step="0.01" placeholder="輸入賣出價格" value='52'>
                <label for="shares">股票張數 (零股用小數，如 0.1 = 100股):</label>
                <input type="number" id="shares" step="0.001" placeholder="輸入張數" value='5'>
                <div class="row">
                    <div>
                        <label for="fee-discount">券商手續費折扣:</label>
                        <select id="fee-discount">
                            <option value="0.11">1.1 折</option>
                            <option value="0.12">1.2 折</option>
                            <option value="0.13">1.3 折</option>
                            <option value="0.14">1.4 折</option>
                            <option value="0.15">1.5 折</option>
                            <option value="0.16">1.6 折</option>
                            <option value="0.17">1.7 折</option>
                            <option value="0.18">1.8 折</option>
                            <option value="0.19">1.9 折</option>
                            <option value="0.2">2.0 折</option>
                            <option value="0.21">2.1 折</option>
                            <option value="0.22">2.2 折</option>
                            <option value="0.23">2.3 折</option>
                            <option value="0.24">2.4 折</option>
                            <option value="0.25">2.5 折</option>
                            <option value="0.26">2.6 折</option>
                            <option value="0.27">2.7 折</option>
                            <option value="0.28">2.8 折</option>
                            <option value="0.29">2.9 折</option>
                            <option value="0.3">3.0 折</option>
                            <option value="0.31">3.1 折</option>
                            <option value="0.32">3.2 折</option>
                            <option value="0.33">3.3 折</option>
                            <option value="0.34">3.4 折</option>
                            <option value="0.35">3.5 折</option>
                            <option value="0.36">3.6 折</option>
                            <option value="0.37">3.7 折</option>
                            <option value="0.38">3.8 折</option>
                            <option value="0.39">3.9 折</option>
                            <option value="0.4">4.0 折</option>
                            <option value="0.41">4.1 折</option>
                            <option value="0.42">4.2 折</option>
                            <option value="0.43">4.3 折</option>
                            <option value="0.44">4.4 折</option>
                            <option value="0.45">4.5 折</option>
                            <option value="0.46">4.6 折</option>
                            <option value="0.47">4.7 折</option>
                            <option value="0.48">4.8 折</option>
                            <option value="0.49">4.9 折</option>
                            <option value="0.5">5.0 折</option>
                            <option value="0.51">5.1 折</option>
                            <option value="0.52">5.2 折</option>
                            <option value="0.53">5.3 折</option>
                            <option value="0.54">5.4 折</option>
                            <option value="0.55">5.5 折</option>
                            <option value="0.56">5.6 折</option>
                            <option value="0.57">5.7 折</option>
                            <option value="0.58">5.8 折</option>
                            <option value="0.59">5.9 折</option>
                            <option value="0.6">6.0 折</option>
                            <option value="0.61">6.1 折</option>
                            <option value="0.62">6.2 折</option>
                            <option value="0.63">6.3 折</option>
                            <option value="0.64">6.4 折</option>
                            <option value="0.65" selected>6.5 折 (預設)</option>
                            <option value="0.66">6.6 折</option>
                            <option value="0.67">6.7 折</option>
                            <option value="0.68">6.8 折</option>
                            <option value="0.69">6.9 折</option>
                            <option value="0.7">7.0 折</option>
                            <option value="0.71">7.1 折</option>
                            <option value="0.72">7.2 折</option>
                            <option value="0.73">7.3 折</option>
                            <option value="0.74">7.4 折</option>
                            <option value="0.75">7.5 折</option>
                            <option value="0.76">7.6 折</option>
                            <option value="0.77">7.7 折</option>
                            <option value="0.78">7.8 折</option>
                            <option value="0.79">7.9 折</option>
                            <option value="0.8">8.0 折</option>
                            <option value="0.81">8.1 折</option>
                            <option value="0.82">8.2 折</option>
                            <option value="0.83">8.3 折</option>
                            <option value="0.84">8.4 折</option>
                            <option value="0.85">8.5 折</option>
                            <option value="0.86">8.6 折</option>
                            <option value="0.87">8.7 折</option>
                            <option value="0.88">8.8 折</option>
                            <option value="0.89">8.9 折</option>
                            <option value="0.9">9.0 折</option>
                            <option value="0.91">9.1 折</option>
                            <option value="0.92">9.2 折</option>
                            <option value="0.93">9.3 折</option>
                            <option value="0.94">9.4 折</option>
                            <option value="0.95">9.5 折</option>
                            <option value="0.96">9.6 折</option>
                            <option value="0.97">9.7 折</option>
                            <option value="0.98">9.8 折</option>
                            <option value="0.99">9.9 折</option>
                            <option value="1.0">10 折</option>
                        </select>
                    </div>
                    <div>
                        <label for="trade-mode">交易模式:</label>
                        <select id="trade-mode">
                            <option value="台股">台股</option>
                            <option value="ETF">ETF</option>
                            <option value="現股當沖">現股當沖</option>
                        </select>
                    </div>
                </div>
                <button onclick="calculateProfit()">計算利潤</button>
            </div>

            <!-- 計算結果 -->
            <div class="result-section" id="result">
                <h2>分析報告</h2>
                <div class="button-container">
                    <div class="button-with-text" onclick="downloadResultAsImage()">
                        <button class="download-button"></button>
                        <span>下載報告</span>
                    </div>
                    <button class="line-button" onclick="shareToLine()" title="分享到 Line"></button>
                    <button class="facebook-button" onclick="shareToFacebook()" title="分享到 Facebook"></button>
                </div>
                <p>利潤: <span id="profit">0</span> 元</p>
                <p>買入總額: <span id="buy-total">0</span> 元</p>
                <p>賣出總額: <span id="sell-total">0</span> 元</p>
                <p>買入手續費: <span id="buy-fee">0</span> 元</p>
                <p>賣出手續費: <span id="sell-fee">0</span> 元</p>
                <p>證券交易稅: <span id="tax">0</span> 元</p>
            </div>

            <!-- 新增的相關連結區塊 -->
            <div class="links-section">
                <h1>相關連結</h1>
                <ul>
                    <li><a href="https://www.youtube.com/@吉米理財學堂" target="_blank">吉米理財學堂</a></li>
                    <li><a href="https://www.udemy.com/user/xie-rui-qun/?srsltid=AfmBOorXUnB2_pNqickzLwE9CRYyluNpW_SaJzjy9S0yhen53U8oRKMf" target="_blank">Udemy線上課程</a></li>
                    <li><a href="https://instagram.com/jimbtcusdt" target="_blank">Instagram</a></li>
                    <li><a href="https://max.maicoin.com/signup?r=7e3853cc" target="_blank">MAX交易所註冊</a></li>
                    <li><a href="https://binance.com/zh-TC/futures/ref?code=567613191" target="_blank">幣安交易所註冊</a></li>
                </ul>
            </div>
        </div>

        <!-- 右側欄：說明與其他內容 -->
        <div class="right-column">
            <!-- Google AdSense 橫幅廣告空間 -->
            <div class="ad-space" id="banner-ad">
                <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3440199491716602"
                        crossorigin="anonymous"></script>
                <ins class="adsbygoogle"
                     style="display:block"
                     data-ad-client="ca-pub-3440199491716602"
                     data-ad-slot="1234567890"
                     data-ad-format="auto"
                     data-full-width-responsive="true"></ins>
                <script>
                    (adsbygoogle = window.adsbygoogle || []).push({});
                </script>
            </div>

            <!-- 使用說明 -->
            <div class="guide-section">
                <h1>歡迎體驗「台灣股票利潤計算機」 - 您的台股交易最佳助手！</h1>
                <p>想知道股票交易能賺多少？還是怕手續費、稅金算不清楚？別擔心！「台灣股票利潤計算機」由<a href="https://www.youtube.com/@吉米理財學堂" target="_blank">吉米理財學堂</a>精心打造，幫您一鍵搞定台股、ETF、現股當沖的利潤分析，省時又省力！無論您是新手還是老手，這款免費工具都能讓您輕鬆掌握交易全貌。以下是使用秘訣，快來試試吧！</p>
                <h2>Step 1：輸入基本交易資訊</h2>
                <p><strong>買入價格 & 賣出價格</strong><br>在「買入價格」和「賣出價格」欄位，輸入您的交易價格（支援小數點後兩位）。</p>
                <p><strong>股票張數</strong><br>填入您交易的張數，支援零股計算（例如 0.1 表示 100 股）。精準到小數點後三位，讓您的每一股都算得清清楚楚！</p>
                <p><strong>價格互換超方便</strong><br>想快速比較買賣順序的利潤？點擊「價格互換」按鈕，買入與賣出價格瞬間對調，靈活又省事。</p>
                <h2>Step 2：設定交易條件</h2>
                <p><strong>券商手續費折扣</strong><br>從下拉選單挑選您的手續費折扣（預設 6.5 折，範圍從 1.1 折到 10 折）。無論您跟哪家券商合作，這裡都能精準匹配！</p>
                <p><strong>交易模式</strong><br>選擇您的交易類型：台股、ETF 或現股當沖。系統會自動調整手續費率與交易稅率（台股 0.3%、ETF 0.1%、當沖 0.15%），讓計算更貼近真實。</p>
                <h2>Step 3：一鍵計算，結果秒現</h2>
                <p>點擊「計算利潤」按鈕，馬上看到完整分析報告：</p>
                <ul>
                    <li><strong>利潤</strong>：紅色代表賺錢，綠色提醒虧損，一目了然。</li>
                    <li><strong>買入總額 / 賣出總額</strong>：包含手續費後的真實成本與收入。</li>
                    <li><strong>手續費 & 交易稅</strong>：細項拆分，透明公開，絕不漏算。</li>
                </ul>
                <h2>開始吧！</h2>
            </div>

            <!-- 隱私權政策 -->
            <div class="privacy-section">
                <h1>隱私權政策</h1>
                <p>我們的應用程式不會收集個人資訊。</p>
                <p>理財工具系列作品由 <a href="https://www.youtube.com/@吉米理財學堂" target="_blank">吉米理財學堂</a> 授權開發</p>
                <p>如有任何問題，請聯絡我們：<a href="mailto:xbon510@gmail.com">xbon510@gmail.com</a></p>
            </div>

            <!-- Google AdSense 自適應廣告空間 -->
            <div class="ad-space" id="responsive-ad">
                <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3440199491716602"
                        crossorigin="anonymous"></script>
                <ins class="adsbygoogle"
                     style="display:block"
                     data-ad-client="ca-pub-3440199491716602"
                     data-ad-slot="0987654321"
                     data-ad-format="auto"
                     data-full-width-responsive="true"></ins>
                <script>
                    (adsbygoogle = window.adsbygoogle || []).push({});
                </script>
            </div>
        </div>

        <!-- 頁腳 -->
        <footer style="width: 100%;">
            <p>© 2025 <a href="https://www.youtube.com/@吉米理財學堂" target="_blank">吉米理財學堂</a>。保留所有權利。</p>
        </footer>
    </div>

    <script>
        // 格式化數字為千位分隔符
        function formatNumber(num) {
            return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }

        // 互換買入價格與賣出價格
        function swapPrices() {
            const buyPrice = document.getElementById("buy-price").value;
            const sellPrice = document.getElementById("sell-price").value;
            document.getElementById("buy-price").value = sellPrice;
            document.getElementById("sell-price").value = buyPrice;
        }

        // 計算利潤
        function calculateProfit() {
            const buyPrice = parseFloat(document.getElementById("buy-price").value) || 0;
            const sellPrice = parseFloat(document.getElementById("sell-price").value) || 0;
            const shares = parseFloat(document.getElementById("shares").value) || 0;
            const discount = parseFloat(document.getElementById("fee-discount").value);
            const mode = document.getElementById("trade-mode").value;
            const volume = shares * 1000;

            let buyFeeRate, sellFeeRate, taxRate;
            switch (mode) {
                case "台股":
                    buyFeeRate = 0.001425;
                    sellFeeRate = 0.001425;
                    taxRate = 0.003;
                    break;
                case "ETF":
                    buyFeeRate = 0.001;
                    sellFeeRate = 0.001;
                    taxRate = 0.001;
                    break;
                case "現股當沖":
                    buyFeeRate = 0.0015;
                    sellFeeRate = 0.0015;
                    taxRate = 0.0015;
                    break;
                default:
                    buyFeeRate = 0.001425;
                    sellFeeRate = 0.001425;
                    taxRate = 0.003;
            }

            let buyFee = Math.max(buyPrice * volume * buyFeeRate * discount, 20);
            let sellFee = Math.max(sellPrice * volume * sellFeeRate * discount, 20);
            if (buyPrice === 0 || shares === 0) buyFee = 0;
            if (sellPrice === 0 || shares === 0) sellFee = 0;

            const tax = sellPrice * volume * taxRate;
            const buyTotal = buyPrice * volume + buyFee;
            const sellTotal = sellPrice * volume - sellFee - tax;
            const profit = sellTotal - buyTotal;

            const profitElement = document.getElementById("profit");
            const buyTotalElement = document.getElementById("buy-total");
            const sellTotalElement = document.getElementById("sell-total");

            const formattedProfit = formatNumber(profit.toFixed(0));
            const formattedBuyTotal = formatNumber(buyTotal.toFixed(0));
            const formattedSellTotal = formatNumber(sellTotal.toFixed(0));

            const className = profit >= 0 ? "profit-positive" : "profit-negative";
            profitElement.innerText = formattedProfit;
            profitElement.className = className;
            buyTotalElement.innerText = formattedBuyTotal;
            buyTotalElement.className = className;
            sellTotalElement.innerText = formattedSellTotal;
            sellTotalElement.className = className;

            document.getElementById("buy-fee").innerText = formatNumber(buyFee.toFixed(0));
            document.getElementById("sell-fee").innerText = formatNumber(sellFee.toFixed(0));
            document.getElementById("tax").innerText = formatNumber(tax.toFixed(0));
        }

        // 截取包含網站標識、輸入表單和分析報告的完整圖片
        function captureFullResult(callback) {
            const siteTitle = document.querySelector(".site-title");
            const formSection = document.querySelector(".form-section");
            const resultSection = document.getElementById("result");
            
            // 創建臨時容器
            let tempContainer = document.getElementById("screenshot-container");
            if (!tempContainer) {
                tempContainer = document.createElement("div");
                tempContainer.id = "screenshot-container";
                document.body.appendChild(tempContainer);
            }
            
            // 複製內容到臨時容器
            tempContainer.innerHTML = "";
            const siteTitleClone = siteTitle.cloneNode(true);
            const formClone = formSection.cloneNode(true);
            const resultClone = resultSection.cloneNode(true);
            tempContainer.appendChild(siteTitleClone);
            tempContainer.appendChild(formClone);
            tempContainer.appendChild(resultClone);

            // 移除複製區域中的按鈕容器，避免截圖包含按鈕
            const buttonContainer = tempContainer.querySelector(".button-container");
            if (buttonContainer) buttonContainer.remove();

            // 使用 html2canvas 截圖並回傳 canvas
            html2canvas(tempContainer).then(canvas => {
                callback(canvas);
                // 清理臨時容器
                tempContainer.innerHTML = "";
            });
        }

        // 下載完整圖片（包含網站標識、輸入表單和分析報告）
        function downloadResultAsImage() {
            captureFullResult(canvas => {
                const link = document.createElement("a");
                link.download = "stock_profit_full_result.png";
                link.href = canvas.toDataURL("image/png");
                link.click();
            });
        }

        // 分享到 Line（包含網站標識、輸入表單和分析報告）
        function shareToLine() {
            captureFullResult(canvas => {
                const imageData = canvas.toDataURL("image/png");
                const url = "https://xbon520.github.io/";
                const text = `我的股票利潤計算結果圖表，請查看：${url}`;
                const encodedText = encodeURIComponent(text);
                const lineUrl = `https://line.me/R/msg/text/?${encodedText}`;
                window.open(lineUrl, '_blank');
                alert("Line 不支援直接分享圖片，請下載圖片後手動分享至 Line。圖片已自動下載。");
                const link = document.createElement("a");
                link.download = "stock_profit_full_result.png";
                link.href = imageData;
                link.click();
            });
        }

        // 分享到 Facebook（包含網站標識、輸入表單和分析報告）
        function shareToFacebook() {
            captureFullResult(canvas => {
                const imageData = canvas.toDataURL("image/png");
                const url = "https://xbon520.github.io/";
                const encodedUrl = encodeURIComponent(url);
                const facebookUrl = `https://www.facebook.com/sharer/sharer.php?u=${encodedUrl}`;
                window.open(facebookUrl, '_blank');
                alert("Facebook 不支援直接分享圖片，請下載圖片後手動上傳至 Facebook。圖片已自動下載。");
                const link = document.createElement("a");
                link.download = "stock_profit_full_result.png";
                link.href = imageData;
                link.click();
            });
        }
    </script>
</body>
</html>
